<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "../dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.ChampMapper">

	<insert id="insertChampion" parameterType="data.dto.ChampionDto">
		INSERT INTO champions
		(id, name, title, blurb, image)
		VALUES (#{id}, #{name}, #{title},
		#{blurb}, #{image})
	</insert>

	<!-- champion ID로 ChampionDto를 조회하는 SQL -->
	<select id="findChampionById" resultType="data.dto.ChampionDto">
		SELECT id, name, title,
		blurb, image
		FROM champions
		WHERE id = #{id}
	</select>

	<!-- 모든 champion 데이터를 조회하는 SQL -->
	<select id="findAllChampions" resultType="data.dto.ChampionDto">
		SELECT id, name, title,
		blurb, image
		FROM champions
	</select>
	<select id="getChampionRating" resultType="ratingDto">
        SELECT champion_id AS championId, rating
        FROM champion_ratings
        WHERE champion_id = #{championId}
    </select>
	<insert id="insertRating" parameterType="data.dto.RatingDto">
   		INSERT INTO champion_ratings (champion_id, rating)
    	VALUES (#{championId}, #{rating});
	</insert>
	<select id="getChampionComments" parameterType="String"
		resultType="List">
		SELECT comment
		FROM champion_comments
		WHERE champion_id = #{championId}
		ORDER BY created_at DESC
	</select>

	<!-- 댓글 저장 -->
	<insert id="insertComment" parameterType="data.dto.CommentDto">
    	INSERT INTO comments (champion_id, user_id, content, created_at)
    	VALUES (#{championId}, #{userId}, #{content}, NOW())
	</insert>
	<select id="checkChampionExist" resultType="int">
    	SELECT COUNT(*) 
    	FROM champion 
    	WHERE id = #{championId}
	</select>	
	<insert id="insertChampionRating" parameterType="map">
    	INSERT INTO champion_ratings (champion_id, rating)
    	VALUES (#{championId}, #{rating});
	</insert>
</mapper> 